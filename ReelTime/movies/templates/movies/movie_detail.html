{% extends 'reel_time/partials/base.html' %}

{% load static %}

{% block title %}{{ detail.movie.title }} - ReelTime{% endblock title %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/movie_detail.css' %}">
{% endblock extra_head %}

{% block content %}
<div class="page-content">
    <div class="container">
        <div class="movie-detail-container">
            {# Back Button inside the card #}
            <a href="{% url 'movie_list' %}" class="btn-back-small">
                <svg class="back-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
            </a>
                
            {# Section for the Movie Poster #}
            <div class="movie-poster-section">
                {% comment %} 
                    NOTE: Replace 'detail.movie.poster_url' with your actual field name 
                    that holds the URL or path to the movie poster/logo.
                {% endcomment %}
                {% if detail.poster.url %} 
                    <img src="{{ detail.poster.url }}" alt="{{ detail.movie.title }} Poster" class="movie-detail-poster">
                {% else %}
                    {# Fallback if no poster URL is available #}
                    <img src="{% static 'images/default_poster.png' %}" alt="Default Movie Poster" class="movie-detail-poster placeholder">
                {% endif %}
            </div>

            {# Section for Movie Information #}
            <div class="movie-info-section">
                <h2>{{ detail.movie.title }}</h2>

                <p><strong>Release Date:</strong> {{ release_label }}</p>
                <p><strong>End Date:</strong> {{ end_date_label }}</p>
                <p><strong>Showing Times:</strong> {{ showing_times_display }}</p>
                <p><strong>Genre:</strong> {{ detail.movie.genre }}</p>
                <p><strong>Description:</strong> {{ detail.movie.description }}</p>

                {% if can_manage %}
                    <div class="actions">
                        <a href="{% url 'edit_movie' detail.pk %}" class="btn btn-warning">Edit</a>
                        <button class="btn btn-danger" 
                            onclick="openDeleteModal('{{ detail.movie.title|escapejs }}', '{% url 'delete_movie' detail.pk %}');">
                            Delete
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-icon-wrapper">
                <svg class="modal-icon-danger" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
            </div>
            <button class="modal-close" onclick="closeDeleteModal()">Ã—</button>
            <div class="modal-header">
                <h3>Delete Movie</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete</p>
                <p class="movie-title-highlight" id="movieTitleToDelete"></p>
                <p class="modal-warning">
                    <svg class="warning-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    This action cannot be undone. All reservations for this movie will also be deleted.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal-cancel" onclick="closeDeleteModal()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Cancel
                </button>
                <form id="deleteForm" method="POST" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-modal-delete">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                        Yes, Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
    // Delete Modal Functions
    function openDeleteModal(movieTitle, deleteUrl) {
        document.getElementById('movieTitleToDelete').textContent = movieTitle;
        document.getElementById('deleteForm').action = deleteUrl;
        document.getElementById('deleteModal').classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
        document.body.style.overflow = ''; // Restore scrolling
    }

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeDeleteModal();
        }
    });

    // Close modal when clicking outside
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeDeleteModal();
        }
    });
</script>
{% endblock extra_js %}