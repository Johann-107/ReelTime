{% extends 'reel_time/partials/base.html' %} 
{% load static %}

{% block title %}All Movies - ReelTime{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/movie_list.css' %}">
{% endblock %}

{% block content %}
<main class="page-content">
  <div class="container">
    <h1 class="page-title">All Movies</h1>

    <div class="search-filter-bar">
      <div class="search-wrapper">
        <input type="search" id="movieSearch" placeholder="Search movies..." class="search-input">
      </div>

      <select id="genreFilter" class="filter-select">
        <option value="all">All Genres</option>
        <option value="action">Action</option>
        <option value="adventure">Adventure</option>
        <option value="thriller">Thriller</option>
        <option value="sci-fi">Sci-Fi</option>
        <option value="romance">Romance</option>
        <option value="comedy">Comedy</option>
      </select>
    </div>

    {% for movie in movies %}
      {% with detail=movie.detail %}
        <div class="movie-card">
          {% if user.is_authenticated and user.is_admin %}
            <a href="{% url 'movie_detail' movie.detail.pk %}" class="movie-link">
              <h3>{{ movie.detail.movie.title }}</h3>
            </a>
          {% else %}
            <h3>{{ movie.detail.movie.title }}</h3>
          {% endif %}

          {% if detail.poster %}
            <img src="{{ detail.poster.url }}" alt="{{ detail.movie.title }} Poster" width="200px">
          {% else %}
            <img src="{% static 'images/default_poster.jpg' %}" alt="No poster available" width="200px">
          {% endif %}

          <p><strong>Duration:</strong> {{ detail.movie.duration_minutes }} minutes</p>
          <p><strong>Showtimes:</strong> {{ movie.showing_times_display }}</p>
          <p><strong>Release Date:</strong> {{ movie.release_label }}</p>
          <p><strong>End Date:</strong> {{ movie.end_date }}</p>

          <button class="btn-reserve"
                  data-movie-title="{{ detail.movie.title }}"
                  data-movie-id="{{ detail.movie.id }}">
              Reserve Movie
          </button>
        </div>
      {% endwith %}
    {% empty %}
      <p>No movies available at the moment.</p>
    {% endfor %}
  </div>
</main>
{% endblock %}

{% block extra_js %}
    <script>
        const STATIC_URL = "{% static '' %}";
        
        // Add event listeners to all reserve buttons
        document.addEventListener('DOMContentLoaded', function() {
            const reserveButtons = document.querySelectorAll('.btn-reserve');
            reserveButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const movieTitle = this.getAttribute('data-movie-title');
                    const movieId = this.getAttribute('data-movie-id');
                    reserveMovie(movieTitle, movieId);
                });
            });
        });
        
        function reserveMovie(movieTitle, movieId) {
            // Redirect to reservation page
            window.location.href = `/movies/reserve/${movieId}/`;
        }
    </script>
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
{% endblock extra_js %} 
