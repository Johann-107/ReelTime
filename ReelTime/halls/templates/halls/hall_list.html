{% extends 'reel_time/partials/base.html' %}
{% load static %}

{% block title %}Manage Halls - ReelTime{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/hall_list.css' %}">
<link rel="stylesheet" href="{% static 'css/reservations.css' %}">
{% endblock extra_head %}

{% block content %}
<div class="page-content">
    <div class="halls-container">
        <div class="halls-header">
            <h1 class="halls-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 0.5rem;">
                    <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
                    <polyline points="17 2 12 7 7 2"/>
                </svg>
                Manage Halls
            </h1>
            <a href="{% url 'hall_add' %}" class="btn-add-hall">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add New Hall
            </a>
        </div>

        {% if halls %}
            <div class="halls-grid">
                {% for hall in halls %}
                <div class="hall-card">
                    <div class="hall-card-header">
                        <div class="hall-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
                                <polyline points="17 2 12 7 7 2"/>
                            </svg>
                        </div>
                        <h3 class="hall-name">{{ hall.name }}</h3>
                    </div>
                    
                    <div class="hall-info">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <span>Capacity: <strong>{{ hall.capacity }}</strong> seats</span>
                    </div>

                    <div class="hall-actions">
                        <a href="{% url 'hall_edit' hall.id %}" class="hall-btn hall-btn-edit">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                            Edit
                        </a>
                        <button class="hall-btn hall-btn-delete" onclick="openDeleteModal('{{ hall.name|escapejs }}', '{% url 'hall_delete' hall.id %}', {{ hall.capacity }});">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                            Delete
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
                    <polyline points="17 2 12 7 7 2"/>
                </svg>
                <h3 class="empty-title">No Halls Added Yet</h3>
                <p class="empty-text">Create your first hall to start managing seating layouts and capacity.</p>
                <a href="{% url 'hall_add' %}" class="btn-add-hall">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Add Your First Hall
                </a>
            </div>
        {% endif %}
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-icon-wrapper">
                <svg class="modal-icon-danger" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
            </div>
            <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
            <div class="modal-header">
                <h3>Delete Hall</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to permanently delete</p>
                <p class="movie-title-highlight" id="hallNameToDelete"></p>
                <div class="reservation-info">
                    <p><strong>Capacity:</strong> <span id="hallCapacity"></span> seats</p>
                </div>
                <p class="modal-warning">
                    <svg class="warning-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    This action cannot be undone. The hall layout will be permanently removed.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal-cancel" onclick="closeDeleteModal()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    No, Keep It
                </button>
                <form id="deleteForm" method="POST" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-modal-delete">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                        Yes, Delete Permanently
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Delete Modal Functions
    function openDeleteModal(hallName, deleteUrl, capacity) {
        document.getElementById('hallNameToDelete').textContent = hallName;
        document.getElementById('hallCapacity').textContent = capacity;
        document.getElementById('deleteForm').action = deleteUrl;
        document.getElementById('deleteModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
        document.body.style.overflow = '';
    }

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeDeleteModal();
        }
    });

    // Close modal when clicking outside
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeDeleteModal();
        }
    });
</script>
{% endblock extra_js %}
