{% extends 'reel_time/partials/base.html' %}
{% load static %}

{% block title %}{{ hall.name|default:"Add Hall" }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/hall_form.css' %}">
{% endblock %}

{% block content %}
<div class="page-content">
  <div class="container" style="padding: 2rem 1rem;">
    <a href="{% url 'hall_list' %}" style="display: inline-flex; align-items: center; justify-content: center; width: 45px; height: 45px; background: #C73E1D; border: 2px solid #C73E1D; border-radius: 50%; color: white; text-decoration: none; margin-bottom: 1.5rem; box-shadow: 0 2px 12px rgba(199, 62, 29, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 16px rgba(199, 62, 29, 0.4)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 12px rgba(199, 62, 29, 0.3)';">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width: 22px; height: 22px;">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
    </a>
    <div class="hall-form-container">
    <div class="hall-form-header">
      <h1 class="hall-form-title">
        {% if hall.pk %}
          ğŸ¬ Edit Hall: {{ hall.name }}
        {% else %}
          âœ¨ Create New Hall
        {% endif %}
      </h1>
    </div>

    <div class="hall-form-content">
      <form id="hall-form" method="POST">
        {% csrf_token %}

        <!-- Hidden fields -->
        <input type="hidden" name="layout" id="layout-input" />
        <input type="hidden" id="capacity-input" name="capacity" value="{{ hall.capacity|default:0 }}" />

        <!-- Basic Information Section -->
        <div class="form-section">
          <h2 class="form-section-title">ğŸ“‹ Basic Information</h2>
          
          <div class="form-group">
            <label for="name-input" class="form-label">Hall Name</label>
            <input type="text" id="name-input" name="name" class="form-input"
                   value="{{ hall.name|default:'' }}" required />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="capacity-display" class="form-label">Maximum Capacity</label>
              <input type="number" id="capacity-display" class="form-input"
                     value="{{ hall.capacity|default:0 }}" min="1" required
                     onchange="document.getElementById('capacity-input').value=this.value" />
            </div>

            <div class="form-group">
              <label for="rows-input" class="form-label">Number of Rows</label>
              <input type="number" id="rows-input" class="form-input"
                     min="1" max="30" value="{{ rows|length|default:5 }}" />
            </div>

            <div class="form-group">
              <label for="cols-input" class="form-label">Number of Columns</label>
              <input type="number" id="cols-input" class="form-input"
                     min="1" max="30" value="{{ cols|length|default:8 }}" />
            </div>
          </div>
        </div>

        <!-- Legend Section -->
        <div class="legend-section">
          <h3 class="legend-title">ğŸ¨ Design Legend</h3>
          <div class="legend-items">
            <div class="legend-item">
              <span class="legend-icon">ğŸ’º</span>
              <span>Seat (Blue)</span>
            </div>
            <div class="legend-item">
              <span class="legend-icon">ğŸ¬</span>
              <span>Screen (Green - Auto-placed)</span>
            </div>
            <div class="legend-item">
              <span class="legend-icon">ğŸšª</span>
              <span>Entrance (Gold)</span>
            </div>
            <div class="legend-item">
              <span class="legend-icon">ğŸš¨</span>
              <span>Exit (Red)</span>
            </div>
          </div>
        </div>

        <!-- Designer Section -->
        <div class="designer-section">
          <!-- Tools Panel -->
          <div class="tools-panel">
            <h3 class="tools-title">ğŸ› ï¸ Design Tools</h3>
            
            <button type="button" class="tool-btn tool-btn-seat active-tool" data-type="seat">
              ğŸ’º Place Seat
            </button>
            

            
            <button type="button" class="tool-btn tool-btn-entrance" data-type="entrance">
              ğŸšª Place Entrance
            </button>
            
            <button type="button" class="tool-btn tool-btn-exit" data-type="exit">
              ğŸš¨ Place Exit
            </button>
            
            <button type="button" class="tool-btn tool-btn-erase" data-type="erase">
              ğŸ—‘ï¸ Eraser
            </button>

            <div class="history-controls">
              <button type="button" id="undo-btn" class="btn-history" disabled>
                â†¶ Undo
              </button>
              <button type="button" id="redo-btn" class="btn-history" disabled>
                â†· Redo
              </button>
            </div>

            <button type="button" id="clear-grid" class="btn-clear-grid">
              âš ï¸ Clear All
            </button>
          </div>

          <!-- Grid Container -->
          <div class="grid-wrapper">
            <div class="screen-label">SCREEN</div>
            <div id="grid-container"></div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button type="submit" class="btn-save">
            ğŸ’¾ Save Hall
          </button>
          <a href="{% url 'hall_list' %}" class="btn-cancel">
            âŒ Cancel
          </a>
        </div>

      </form>
    </div>
  </div>
  </div>
</div>

<script src="{% static 'js/hall_form.js' %}"></script>
<script>
  // Load saved layout on page load (if editing existing hall)
  {% if hall and hall.layout %}
    const savedLayout = {{ hall.layout|safe }};
    document.addEventListener('DOMContentLoaded', function() {
      window.loadSavedLayout(savedLayout);
    });
  {% else %}
    document.addEventListener('DOMContentLoaded', function() {
      window.loadSavedLayout([]);
    });
  {% endif %}

  // Update capacity input when display changes
  document.getElementById('capacity-display').addEventListener('change', function() {
    document.getElementById('capacity-input').value = this.value;
  });
</script>
{% endblock %}
