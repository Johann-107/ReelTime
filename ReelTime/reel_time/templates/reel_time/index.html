{% extends 'reel_time/partials/base.html' %} 
{% load static %}

{% block title %}ReelTime - Home Page{% endblock title %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
    <style>
        /* Add these styles for rating badges */
        .rating-badge {
            display: inline-block;
            padding: 4px 8px;
            color: black;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .rating-badge.g { background: #4CAF50; }
        .rating-badge.pg { background: #FF9800; }
        .rating-badge.spg { background: #F44336; }
        .rating-badge.na { background: #9E9E9E; }
        
        /* Style for release date in coming soon */
        .movie-release-date {
            font-size: 0.8em;
            color: #666;
            margin-top: 4px;
        }
        
        /* Empty state styling */
        .empty-message {
            text-align: center;
            padding: 20px;
            color: #999;
            font-style: italic;
            grid-column: 1 / -1;
        }
        
        /* Make "Book Now" button full width */
        .btn-book {
            width: 100%;
            text-align: center;
        }
    </style>
{% endblock extra_head %}

{% block content %}
    <section class="hero-new-design">
        <div class="container hero-split-content">
            <div class="hero-text-content">
                <h1 class="hero-title">Your Movie <span class="hero-accent">ReelTime</span> Starts Now</h1>
                <p class="hero-description">Book your favorite movies in under 2 minutes. Choose your seats, pick your showtime, and enjoy the magic of cinema.</p>
                <div class="hero-buttons">
                    <a href="{% url 'index' %}" class="btn btn-start-watching btn-lg">Start Watching 
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px; margin-left: 8px;">
                            <path d="M5 12h14M12 5l7 7-7 7"></path>
                        </svg>
                    </a>
                    <a href="#" onclick="openLoginModal(); return false;" class="btn btn-ghost-dark btn-lg">Sign In</a>
                </div>
            </div>

            {# COMING SOON SECTION - DYNAMIC #}
            <div class="coming-soon-panel">
                <h2 class="panel-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 24px; height: 24px; margin-right: 8px;">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Coming Soon
                </h2>
                <div class="coming-soon-list">
                    {% for movie_detail in coming_soon_movies %}
                    <div class="coming-soon-item">
                        {% if movie_detail.poster_url %}
                            <img src="{{ movie_detail.poster_url }}" alt="{{ movie_detail.movie.title }}" class="coming-soon-poster">
                        {% else %}
                            <img src="{% static 'images/default-movie-poster.jpg' %}" alt="{{ movie_detail.movie.title }}" class="coming-soon-poster">
                        {% endif %}
                        <div class="coming-soon-details">
                            <p class="movie-title-small">{{ movie_detail.movie.title }}</p>
                            <p class="movie-genre-small">
                                {% if movie_detail.movie.get_genres_display %}
                                    {{ movie_detail.movie.get_genres_display|truncatechars:20 }}
                                {% else %}
                                    Coming Soon
                                {% endif %}
                            </p>
                            <p class="movie-release-date">
                                Releases: {{ movie_detail.release_date|date:"M d, Y" }}
                            </p>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-message">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 48px; height: 48px; opacity: 0.5; margin-bottom: 10px;">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                            <path d="M9 14l6-6"></path>
                        </svg>
                        <p>No upcoming movies announced yet.</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
    
    <section class="hero-content-scroll">
        <div class="container">
            {# MOVIE RECOMMENDATIONS SECTION - DYNAMIC #}
            <div class="recommendations-section">
                <h2 class="section-title-white">Movie Recommendations</h2>
                <p class="section-subtitle-white">Discover amazing movies handpicked just for you</p>
                <div class="movie-grid" id="moviesGrid">
                    {% for movie_detail in available_movies %}
                    <div class="movie-card-new">
                        {% if movie_detail.poster_url %}
                            <img src="{{ movie_detail.poster_url }}" alt="{{ movie_detail.movie.title }}" class="movie-poster-new">
                        {% else %}
                            <img src="{% static 'images/default-movie-poster.jpg' %}" alt="{{ movie_detail.movie.title }}" class="movie-poster-new">
                        {% endif %}
                        <div class="movie-details-new">
                            <h3 class="movie-title-new">{{ movie_detail.movie.title }}</h3>
                            <p class="movie-meta-new">
                                {% if movie_detail.movie.get_genres_display %}
                                    {{ movie_detail.movie.get_genres_display|truncatechars:30 }}
                                {% else %}
                                    Movie
                                {% endif %}
                            </p>
                            
                            <div class="movie-rating-new">
                                {% if movie_detail.movie.rating %}
                                    <span class="rating-badge {{ movie_detail.movie.rating|lower }}">
                                        {{ movie_detail.movie.rating }}
                                    </span>
                                {% else %}
                                    <span class="rating-badge na">
                                        Not Rated
                                    </span>
                                {% endif %}
                            </div>
                            
                            {# SINGLE "BOOK NOW" BUTTON - "MORE INFO" REMOVED #}
                            <div class="movie-actions">
                                {% if user.is_authenticated %}
                                    <a href="#" class="btn btn-accent btn-book">Book Now</a>
                                {% else %}
                                    <a href="#" onclick="openLoginModal(); return false;" class="btn btn-accent btn-book">Book Now</a>
                                {% endif %}
                                {# "More Info" button removed here #}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-message" style="grid-column: 1 / -1;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 64px; height: 64px; opacity: 0.5; margin-bottom: 20px;">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <path d="M9 9l6 6"></path>
                            <path d="M15 9l-6 6"></path>
                        </svg>
                        <h3>No Movies Available</h3>
                        <p>Check back soon for new movie listings!</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="booking-cta-banner">
                <h3 class="booking-cta-title">Ready to Book Your Movie?</h3>
                <p class="booking-cta-subtitle">Sign up now to reserve your seats and enjoy the ultimate cinema experience.</p>
                <div class="booking-cta-actions">
                    <a href="#" onclick="openRegisterModal(); return false;" class="btn btn-accent btn-lg">Create Account</a>
                    <a href="#" onclick="openLoginModal(); return false;" class="btn btn-info btn-lg">Sign In</a> 
                </div>
            </div>
        </div>
    </section>
    
    <section class="mission-section">
        <div class="container">
            <h4 class="mission-title">Why Choose ReelTime?</h4>
            <p class="mission-statement">"More Than Just Tickets â€” ReelTime Delivers Unforgettable Movie Moments, Anytime, Anywhere."</p>
        </div>
    </section>
{% endblock content %}

{% block extra_js %}
    <script>
        const STATIC_URL = "{% static '' %}"; 
    </script>
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/modal.js' %}"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('show_login') === 'true') {
            console.log('Opening login modal from base.html');
            setTimeout(() => {
                if (typeof openLoginModal === 'function') {
                    openLoginModal();
                } else {
                    console.error('openLoginModal function not found');
                }
            }, 100);
        }
    });
    </script>
{% endblock extra_js %}