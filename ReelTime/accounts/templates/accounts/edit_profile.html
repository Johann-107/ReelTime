{% extends 'reel_time/partials/base.html' %} 
{% load static %} 

{# 1. PAGE TITLE BLOCK #}
{% block title %}
    Edit Profile
{% endblock title %}

---

{# 2. PAGE-SPECIFIC CSS BLOCK #}
{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/edit_profile.css' %}">
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
{% endblock extra_head %}

---

{# 3. MAIN CONTENT BLOCK (The Edit Profile Form) #}
{% block content %}
<div class="page-content">
    <div class="container" style="max-width: 600px; padding: 2rem 1rem;">
        <div class="edit-container">
            <h1>Edit Profile</h1>

    {# IMPORTANT: Add enctype="multipart/form-data" for file uploads #}
    <form method="POST" enctype="multipart/form-data" class="edit-form">
        {% csrf_token %}
        <div class="profile-picture-upload">
            <div class="current-picture">
                {% if user.profile_picture %}
                    <img    src="{{ user.profile_picture_url }}" 
                            alt="Current Profile Picture" 
                            id="preview-image">
                {% else %}
                    <div class="profile-picture-placeholder" id="preview-image">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="profile_picture">Profile Picture:</label>
                <input type="file" name="profile_picture" id="profile_picture" accept="image/*" onchange="previewImage(event)">
                <small class="help-text">Upload a profile picture (JPG, PNG)</small>
            </div>
        </div>
        {# --- PROFILE PICTURE SECTION END --- #}

        <div class="form-group">
            <label for="first_name">First Name:</label>
            <input type="text" name="first_name" id="first_name" value="{{ user.first_name }}" required>
        </div>

        <div class="form-group">
            <label for="last_name">Last Name:</label>
            <input type="text" name="last_name" id="last_name" value="{{ user.last_name }}" required>
        </div>

        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" name="username" id="username" value="{{ user.username }}" required>
        </div>

        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" name="email" id="email" value="{{ user.email }}" required>
        </div>

        <div class="form-group">
            <label for="phone_number">Phone Number:</label>
            <input type="text" name="phone_number" id="phone_number" value="{{ user.phone_number }}" required>
        </div>

        <div class="buttons">
            <button type="submit" class="btn save">Save Changes</button>
            <a href="{% url 'profile' %}" class="btn cancel">Cancel</a>
        </div>
    </form>
        </div>
    </div>
</div>
{% endblock content %}

---

{# 4. PAGE-SPECIFIC JAVASCRIPT BLOCK (for the image preview function) #}
{% block extra_js %}
<script>
    function previewImage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewContainer = document.getElementById('preview-image');
                
                if (previewContainer.tagName === 'IMG') {
                    // If it's already an image tag, just update the source
                    previewContainer.src = e.target.result;
                } else {
                    // If it's the placeholder div, replace it with an image tag
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = 'Profile Picture Preview';
                    img.id = 'preview-image';
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    img.style.objectPosition = 'center';
                    img.style.display = 'block';
                    img.style.position = 'absolute';
                    img.style.top = '0';
                    img.style.left = '0';
                    
                    // Replace the placeholder element while preserving its container
                    previewContainer.parentNode.replaceChild(img, previewContainer); 
                }
            }
            reader.readAsDataURL(file);
        }
    }
</script>
{% endblock extra_js %}
